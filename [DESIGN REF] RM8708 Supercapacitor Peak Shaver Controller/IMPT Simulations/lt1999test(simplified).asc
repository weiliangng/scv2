Version 4
SHEET 1 1576 1680
WIRE -720 112 -720 96
WIRE -1696 272 -1808 272
WIRE -1520 272 -1696 272
WIRE -816 272 -1520 272
WIRE -784 272 -816 272
WIRE -768 272 -784 272
WIRE -672 272 -688 272
WIRE -464 272 -672 272
WIRE 544 272 -464 272
WIRE -784 288 -784 272
WIRE -672 288 -672 272
WIRE -192 352 -192 320
WIRE -464 400 -464 272
WIRE -304 400 -464 400
WIRE -48 400 -80 400
WIRE -1040 416 -1040 384
WIRE -816 448 -816 272
WIRE -464 448 -816 448
WIRE -1152 464 -1200 464
WIRE -896 464 -928 464
WIRE 448 464 448 416
WIRE -1808 480 -1808 272
WIRE -1712 480 -1808 480
WIRE -1600 480 -1632 480
WIRE -1536 480 -1600 480
WIRE -1360 480 -1536 480
WIRE -1264 480 -1360 480
WIRE -48 480 -80 480
WIRE 176 480 112 480
WIRE 272 480 176 480
WIRE 416 480 272 480
WIRE -1600 496 -1600 480
WIRE 544 496 544 272
WIRE 544 496 480 496
WIRE 416 512 336 512
WIRE 112 528 112 480
WIRE -896 544 -928 544
WIRE -784 544 -816 544
WIRE -704 544 -784 544
WIRE -464 560 -464 448
WIRE -304 560 -464 560
WIRE -48 560 -80 560
WIRE -1808 576 -1808 560
WIRE -1712 576 -1808 576
WIRE -1600 576 -1600 560
WIRE -1600 576 -1632 576
WIRE -1568 576 -1600 576
WIRE -1264 624 -1264 480
WIRE -1152 624 -1264 624
WIRE -880 624 -928 624
WIRE -1568 640 -1568 576
WIRE -1536 640 -1568 640
WIRE -1360 640 -1536 640
WIRE -1200 640 -1200 464
WIRE -1200 640 -1360 640
WIRE -880 656 -880 624
WIRE -192 656 -192 608
WIRE -1040 704 -1040 672
WIRE 32 736 32 480
WIRE 32 736 -336 736
WIRE -1808 912 -1808 576
WIRE -1056 944 -1056 928
WIRE -784 944 -784 912
WIRE -1856 976 -1984 976
WIRE 32 992 32 736
WIRE 240 992 112 992
WIRE -1808 1008 -1808 992
FLAG 448 528 0
FLAG -848 192 0
FLAG -848 112 1.2V
FLAG 336 512 1.2V
FLAG -960 192 0
FLAG -960 112 24v
FLAG 448 416 24v
FLAG -720 192 0
FLAG -720 96 5V
FLAG -336 816 0
FLAG -672 288 CSN
FLAG -784 288 CSP
FLAG -624 192 0
FLAG -624 112 Vset
FLAG 112 608 0
FLAG 272 480 FBIN
FLAG -1504 1216 0
FLAG -1360 480 CSS3P
FLAG -1360 640 CSS3N
FLAG -784 608 0
FLAG -1536 704 0
FLAG -1536 416 0
FLAG -704 544 set
FLAG -1696 352 0
FLAG 176 544 0
FLAG -1040 384 5V
FLAG -1040 704 0
FLAG -192 656 0
FLAG -192 320 5V
FLAG -880 736 0
FLAG -48 560 set
FLAG -880 624 in
FLAG -1296 1024 0
FLAG -1056 1024 0
FLAG -1296 944 iload
FLAG -1056 928 ibuf
FLAG -784 1024 0
FLAG 112 1056 0
FLAG 240 992 vbuf
FLAG -1808 1008 0
FLAG -1856 928 0
FLAG -1984 1056 0
FLAG -1520 336 0
SYMBOL OpAmps\\UniversalOpAmp 448 496 R0
SYMATTR InstName U2
SYMBOL voltage -848 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 1.20
SYMBOL voltage -960 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 40
SYMBOL res -672 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 0.002
SYMBOL voltage -720 96 R0
SYMATTR InstName V8
SYMATTR Value 5
SYMBOL bv -336 720 R0
WINDOW 3 -39 139 Left 2
SYMATTR Value V=V(CSN,CSP)*50+V(set)
SYMATTR InstName B1
SYMBOL voltage -624 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value PWL(0 2.65 3m 0.65 6m 2.65)
SYMBOL res 128 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 365
SYMBOL res 128 624 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R5
SYMATTR Value 976
SYMBOL res -1792 576 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 2m
SYMBOL bv -1504 1120 R0
WINDOW 3 -15 137 Left 2
SYMATTR Value V=limit((V(CSS3N,CSS3P)*50+2.65),0,3.3)
SYMATTR InstName B2
SYMBOL res -800 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL cap -800 544 R0
SYMATTR InstName C1
SYMATTR Value 47n
SYMBOL cap -1616 496 R0
SYMATTR InstName C2
SYMATTR Value 470n
SYMBOL res -1616 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 10
SYMBOL res -1616 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10
SYMBOL cap -1552 416 R0
SYMATTR InstName C3
SYMATTR Value 22n
SYMBOL cap -1552 640 R0
SYMATTR InstName C4
SYMATTR Value 22n
SYMBOL voltage -1696 256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=0.1
SYMATTR InstName V1
SYMATTR Value 24
SYMBOL cap 160 480 R0
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL OpAmps\\LT1999-50 -1040 544 R0
SYMATTR InstName U1
SYMBOL voltage -880 640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1.85
SYMBOL bv -1296 928 R0
SYMATTR InstName B4
SYMATTR Value V=V(in)-V(set)
SYMBOL bv -1056 928 R0
SYMATTR InstName B5
SYMATTR Value V=V(vbuf)-V(set)
SYMBOL bv -784 928 R0
SYMATTR InstName B6
SYMATTR Value V=V(iload)-V(ibuf)
SYMBOL res 128 976 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL cap 96 992 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMBOL sw -1808 896 R0
SYMATTR InstName Load1
SYMATTR Value SW3
SYMBOL voltage -1984 960 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 5 5m 0.1m 0.1m 2m 4m)
SYMBOL cap -1536 272 R0
SYMATTR InstName C7
SYMATTR Value 470µ
SYMBOL OpAmps\\LT1999-50 -192 480 R0
SYMATTR InstName U3
TEXT -1224 904 Left 2 ;0.1V/A
TEXT -520 104 Left 2 ;I = {(9 + 9 * sin(2 * pi * (time - 0.006) * (20 + 980 * (time - 0.006) / 0.05))) * (1 / (1 + exp(-4000 * (time - 0.006))))}
TEXT 328 696 Left 2 !.tran 60m\n.model SW3 SW(Ron=1.33 Roff=25 Vt=2.5 Vh=0.1)
TEXT -992 864 Left 2 ;0.1V/A also\n-ve means charging supercapacitor\n+ve means dumping into bus
